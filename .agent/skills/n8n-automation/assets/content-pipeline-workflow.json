{
  "name": "Content Marketing Pipeline",
  "nodes": [
    {
      "id": "1",
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 300],
      "parameters": {
        "httpMethod": "POST",
        "path": "content-pipeline",
        "responseMode": "onReceived",
        "options": {
          "allowMultipleConnections": true
        }
      }
    },
    {
      "id": "2",
      "name": "Detect Input Type",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [450, 300],
      "parameters": {
        "jsCode": "// URL ìœ í˜• íŒë³„\nconst url = $json.url || '';\nconst file = $json.file || null;\n\nlet inputType = 'unknown';\nlet projectName = 'untitled';\n\nif (url.includes('youtube.com') || url.includes('youtu.be')) {\n  inputType = 'youtube';\n  // Extract video ID for project name\n  const match = url.match(/(?:v=|\\/)([a-zA-Z0-9_-]{11})/);\n  projectName = match ? match[1] : 'youtube-video';\n} else if (url.startsWith('http')) {\n  inputType = 'website';\n  projectName = new URL(url).hostname.replace('www.', '');\n} else if (file && file.endsWith('.pdf')) {\n  inputType = 'pdf';\n  projectName = file.replace('.pdf', '').split('/').pop();\n}\n\nconst today = new Date().toISOString().split('T')[0];\nconst folderName = `${today}_${projectName}`;\n\nreturn {\n  json: {\n    inputType,\n    url,\n    file,\n    projectName,\n    folderName,\n    outputPath: `vault/content/outputs/${folderName}/`\n  }\n};"
      }
    },
    {
      "id": "3",
      "name": "Switch by Type",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 2,
      "position": [650, 300],
      "parameters": {
        "rules": {
          "rules": [
            {
              "value": "youtube",
              "operation": "equals",
              "value2": "={{ $json.inputType }}"
            },
            {
              "value": "website",
              "operation": "equals",
              "value2": "={{ $json.inputType }}"
            },
            {
              "value": "pdf",
              "operation": "equals",
              "value2": "={{ $json.inputType }}"
            }
          ]
        },
        "fallbackOutput": "extra"
      }
    },
    {
      "id": "4a",
      "name": "YouTube: Download & Transcribe",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [850, 150],
      "parameters": {
        "command": "yt-dlp --write-auto-sub --sub-lang ko,en --skip-download -o \"{{ $json.outputPath }}transcript\" \"{{ $json.url }}\" && cat {{ $json.outputPath }}transcript.*.vtt | grep -v '^[0-9]' | grep -v '^$' | grep -v 'WEBVTT' | head -500"
      }
    },
    {
      "id": "4b",
      "name": "Website: Extract Content",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [850, 300],
      "parameters": {
        "url": "={{ $json.url }}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "text"
            }
          }
        }
      }
    },
    {
      "id": "4c",
      "name": "PDF: Read Content",
      "type": "n8n-nodes-base.readBinaryFile",
      "typeVersion": 1,
      "position": [850, 450],
      "parameters": {
        "filePath": "={{ $json.file }}"
      }
    },
    {
      "id": "5",
      "name": "Merge Content",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2,
      "position": [1050, 300],
      "parameters": {
        "mode": "combine",
        "mergeByFields": {
          "values": [
            {
              "field1": "projectName",
              "field2": "projectName"
            }
          ]
        }
      }
    },
    {
      "id": "6",
      "name": "Generate Brief (AI)",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [1250, 300],
      "parameters": {
        "operation": "text",
        "prompt": "ë‹¤ìŒ ì½˜í…ì¸ ë¥¼ ë¶„ì„í•˜ê³  ë§ˆì¼€íŒ… ë¸Œë¦¬í”„ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”:\n\n{{ $json.content }}\n\në¸Œë¦¬í”„ì— í¬í•¨í•  ë‚´ìš©:\n1. í•µì‹¬ ë©”ì‹œì§€ 3-5ê°œ\n2. íƒ€ê²Ÿ ì˜¤ë””ì–¸ìŠ¤ë³„ ì†Œêµ¬ì \n3. í”Œë«í¼ë³„ ê°ë„ ì œì•ˆ (ë‰´ìŠ¤ë ˆí„°, ë¸”ë¡œê·¸, ë§í¬ë“œì¸, XìŠ¤ë ˆë“œ, ì‡¼ì¸ )\n4. ê¶Œì¥ í‘œí˜„ê³¼ ê¸ˆì§€ í‘œí˜„",
        "maxTokens": 2000,
        "model": "gpt-4o"
      }
    },
    {
      "id": "7",
      "name": "Wait: Approve Brief",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [1450, 300],
      "parameters": {
        "resume": "webhook",
        "options": {
          "webhookSuffix": "/approve-brief"
        }
      }
    },
    {
      "id": "8",
      "name": "Split: Platform Writers",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 2,
      "position": [1650, 300],
      "parameters": {
        "batchSize": 1,
        "options": {}
      }
    },
    {
      "id": "9a",
      "name": "Write: Newsletter",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [1850, 100],
      "parameters": {
        "operation": "text",
        "prompt": "ë‹¤ìŒ ë¸Œë¦¬í”„ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‰´ìŠ¤ë ˆí„°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš” (15,000-20,000ì):\n\n{{ $json.brief }}\n\ní†¤: ì¹œê·¼í•˜ê³  ì‹¤ìš©ì \ní¬ë§·: Q&A ìŠ¤íƒ€ì¼ ë˜ëŠ” ì¸í„°ë·° í˜•ì‹",
        "maxTokens": 4000,
        "model": "gpt-4o"
      }
    },
    {
      "id": "9b",
      "name": "Write: Blog",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [1850, 200],
      "parameters": {
        "operation": "text",
        "prompt": "ë‹¤ìŒ ë¸Œë¦¬í”„ë¥¼ ë°”íƒ•ìœ¼ë¡œ SEO ìµœì í™”ëœ ë¸”ë¡œê·¸ ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš” (3,000-5,000ì):\n\n{{ $json.brief }}\n\ní¬í•¨: ë©”íƒ€ ë””ìŠ¤í¬ë¦½ì…˜, H2/H3 êµ¬ì¡°, í‚¤ì›Œë“œ",
        "maxTokens": 2500,
        "model": "gpt-4o"
      }
    },
    {
      "id": "9c",
      "name": "Write: LinkedIn",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [1850, 300],
      "parameters": {
        "operation": "text",
        "prompt": "ë‹¤ìŒ ë¸Œë¦¬í”„ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë§í¬ë“œì¸ í¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš” (1,500ì ì´ë‚´):\n\n{{ $json.brief }}\n\nìŠ¤íƒ€ì¼: ì§ì¥ì¸ íƒ€ê²Ÿ, CTA í¬í•¨",
        "maxTokens": 800,
        "model": "gpt-4o"
      }
    },
    {
      "id": "9d",
      "name": "Write: X Thread",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [1850, 400],
      "parameters": {
        "operation": "text",
        "prompt": "ë‹¤ìŒ ë¸Œë¦¬í”„ë¥¼ ë°”íƒ•ìœ¼ë¡œ X ìŠ¤ë ˆë“œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš” (10ê°œ íŠ¸ìœ—):\n\n{{ $json.brief }}\n\nê° íŠ¸ìœ—: 280ì ì´ë‚´, ë…ë¦½ì ìœ¼ë¡œë„ ì´í•´ ê°€ëŠ¥í•˜ê²Œ",
        "maxTokens": 1500,
        "model": "gpt-4o"
      }
    },
    {
      "id": "9e",
      "name": "Write: Shorts Scripts",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [1850, 500],
      "parameters": {
        "operation": "text",
        "prompt": "ë‹¤ìŒ ë¸Œë¦¬í”„ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‡¼ì¸  ëŒ€ë³¸ 3ê°œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš” (ê° 60ì´ˆ):\n\n{{ $json.brief }}\n\nê° ëŒ€ë³¸: í›„í‚¹(5ì´ˆ) + ë³¸ë¬¸(45ì´ˆ) + CTA(10ì´ˆ)\níƒ€ì„ìŠ¤íƒ¬í”„ í¬í•¨",
        "maxTokens": 2000,
        "model": "gpt-4o"
      }
    },
    {
      "id": "10",
      "name": "Merge All Content",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2,
      "position": [2050, 300],
      "parameters": {
        "mode": "append"
      }
    },
    {
      "id": "11",
      "name": "Save Files",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2250, 300],
      "parameters": {
        "jsCode": "// ê²°ê³¼ë¬¼ ì €ì¥ ê²½ë¡œ ìƒì„±\nconst outputPath = $json.outputPath;\nconst files = [\n  { name: 'newsletter.md', content: $json.newsletter },\n  { name: 'blog.md', content: $json.blog },\n  { name: 'linkedin.md', content: $json.linkedin },\n  { name: 'threads/thread.md', content: $json.thread },\n  { name: 'shorts-scripts/shorts-01.md', content: $json.shortsScripts }\n];\n\nreturn {\n  json: {\n    message: 'ëª¨ë“  ì½˜í…ì¸ ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤',\n    outputPath,\n    files: files.map(f => f.name)\n  }\n};"
      }
    },
    {
      "id": "12",
      "name": "Check: Has Video Source",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [2450, 300],
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.inputType }}",
              "operation": "equals",
              "value2": "youtube"
            }
          ]
        }
      }
    },
    {
      "id": "13a",
      "name": "Video: Cut Shorts from Source",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [2650, 200],
      "parameters": {
        "command": "# YouTube ì†ŒìŠ¤ê°€ ìˆì„ ë•Œ: ì˜ìƒ ê¸°ë°˜ ì‡¼ì¸  ìƒì„±\necho 'ffmpegë¡œ ì˜ìƒ í´ë¦½ ìë¥´ê¸° + ìë§‰ ë³‘í•©'"
      }
    },
    {
      "id": "13b",
      "name": "Video: Create from Text",
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [2650, 400],
      "parameters": {
        "command": "# YouTube ì†ŒìŠ¤ê°€ ì—†ì„ ë•Œ: í…ìŠ¤íŠ¸ ê¸°ë°˜ ì‡¼ì¸  ìƒì„±\npython3 .agent/skills/text-based-shorts/scripts/create_video.py --input {{ $json.outputPath }}shorts-scripts/ --output {{ $json.outputPath }}videos/"
      }
    },
    {
      "id": "14",
      "name": "Wait: Final Review",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [2850, 300],
      "parameters": {
        "resume": "webhook",
        "options": {
          "webhookSuffix": "/final-review"
        }
      }
    },
    {
      "id": "15",
      "name": "Notify: Complete",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2,
      "position": [3050, 300],
      "parameters": {
        "channel": "#content-marketing",
        "text": "âœ… ì½˜í…ì¸  íŒŒì´í”„ë¼ì¸ ì™„ë£Œ!\n\nğŸ“‚ í”„ë¡œì íŠ¸: {{ $json.projectName }}\nğŸ“ ê²½ë¡œ: {{ $json.outputPath }}\n\nìƒì„±ëœ ì½˜í…ì¸ :\nâ€¢ Newsletter\nâ€¢ Blog\nâ€¢ LinkedIn\nâ€¢ X Thread\nâ€¢ Shorts (3ê°œ)\n\në°°í¬ ìˆœì„œ: Newsletter â†’ Blog â†’ LinkedIn â†’ X â†’ Shorts",
        "attachments": []
      }
    }
  ],
  "connections": {
    "Webhook Trigger": {
      "main": [[{"node": "Detect Input Type", "type": "main", "index": 0}]]
    },
    "Detect Input Type": {
      "main": [[{"node": "Switch by Type", "type": "main", "index": 0}]]
    },
    "Switch by Type": {
      "main": [
        [{"node": "YouTube: Download & Transcribe", "type": "main", "index": 0}],
        [{"node": "Website: Extract Content", "type": "main", "index": 0}],
        [{"node": "PDF: Read Content", "type": "main", "index": 0}]
      ]
    },
    "YouTube: Download & Transcribe": {
      "main": [[{"node": "Merge Content", "type": "main", "index": 0}]]
    },
    "Website: Extract Content": {
      "main": [[{"node": "Merge Content", "type": "main", "index": 0}]]
    },
    "PDF: Read Content": {
      "main": [[{"node": "Merge Content", "type": "main", "index": 0}]]
    },
    "Merge Content": {
      "main": [[{"node": "Generate Brief (AI)", "type": "main", "index": 0}]]
    },
    "Generate Brief (AI)": {
      "main": [[{"node": "Wait: Approve Brief", "type": "main", "index": 0}]]
    },
    "Wait: Approve Brief": {
      "main": [[{"node": "Split: Platform Writers", "type": "main", "index": 0}]]
    },
    "Split: Platform Writers": {
      "main": [
        [
          {"node": "Write: Newsletter", "type": "main", "index": 0},
          {"node": "Write: Blog", "type": "main", "index": 0},
          {"node": "Write: LinkedIn", "type": "main", "index": 0},
          {"node": "Write: X Thread", "type": "main", "index": 0},
          {"node": "Write: Shorts Scripts", "type": "main", "index": 0}
        ]
      ]
    },
    "Write: Newsletter": {
      "main": [[{"node": "Merge All Content", "type": "main", "index": 0}]]
    },
    "Write: Blog": {
      "main": [[{"node": "Merge All Content", "type": "main", "index": 0}]]
    },
    "Write: LinkedIn": {
      "main": [[{"node": "Merge All Content", "type": "main", "index": 0}]]
    },
    "Write: X Thread": {
      "main": [[{"node": "Merge All Content", "type": "main", "index": 0}]]
    },
    "Write: Shorts Scripts": {
      "main": [[{"node": "Merge All Content", "type": "main", "index": 0}]]
    },
    "Merge All Content": {
      "main": [[{"node": "Save Files", "type": "main", "index": 0}]]
    },
    "Save Files": {
      "main": [[{"node": "Check: Has Video Source", "type": "main", "index": 0}]]
    },
    "Check: Has Video Source": {
      "main": [
        [{"node": "Video: Cut Shorts from Source", "type": "main", "index": 0}],
        [{"node": "Video: Create from Text", "type": "main", "index": 0}]
      ]
    },
    "Video: Cut Shorts from Source": {
      "main": [[{"node": "Wait: Final Review", "type": "main", "index": 0}]]
    },
    "Video: Create from Text": {
      "main": [[{"node": "Wait: Final Review", "type": "main", "index": 0}]]
    },
    "Wait: Final Review": {
      "main": [[{"node": "Notify: Complete", "type": "main", "index": 0}]]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "meta": {
    "templateId": "content-marketing-pipeline",
    "templateVersion": "1.0.0",
    "description": "ì½˜í…ì¸  ë§ˆì¼€íŒ… ìë™í™” íŒŒì´í”„ë¼ì¸ - URL/PDF ì…ë ¥ â†’ AI ì½˜í…ì¸  ìƒì„± â†’ ì‡¼ì¸  ì˜ìƒ ì œì‘"
  }
}
