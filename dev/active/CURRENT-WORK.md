# Current Work State

> **IMPORTANT**: ëª¨ë“  ì—ì´ì „íŠ¸ëŠ” ì„¸ì…˜ ì‹œì‘ ì‹œ ì´ íŒŒì¼ì„ ë°˜ë“œì‹œ ì½ì–´ì•¼ í•©ë‹ˆë‹¤.
> ì‘ì—… ì™„ë£Œ/ì¤‘ë‹¨ ì‹œ ì´ íŒŒì¼ì„ ì—…ë°ì´íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤.

**Last Updated**: 2026-01-09 17:35 KST  
**Updated By**: opencode (ë§¤ì§ë§í¬ ì¸ì¦ êµ¬í˜„ ì™„ë£Œ, ë¹Œë“œ ì„±ê³µ)

---

## ğŸš¨ Active Task: ë¸”ë¡œê·¸ ì¸í”„ë¼ ì¬ì„¤ê³„

**ëª©í‘œ:** Vercel ì„œë²„ë¦¬ìŠ¤ DB ì‘ì—… ì œê±° â†’ Rust APIë¡œ ì´ê´€ (Static Export ì•ˆí•¨)

### ì™œ ì´ ì‘ì—…ì„ í•˜ëŠ”ê°€?
- Vercel ì„œë²„ë¦¬ìŠ¤ cold start ë„ˆë¬´ ëŠë¦¼ (ì‹¤ì‚¬ìš© ë¶ˆê°€)
- ë¬´ë£Œ ì¸í”„ë¼ë¡œ ì™„ì „í•œ ì„œë¹„ìŠ¤ ìš´ì˜ ëª©í‘œ
- ì´ ë¹„ìš©: $0/ì›”

---

## ğŸ—ï¸ ìƒˆ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         pizzar.ing                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚  Vercel (Free)      â”‚      â”‚  OCI E2.1.Micro     â”‚               â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚      â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚               â”‚
â”‚  â”‚  Next.js (SSR)      â”‚ API  â”‚  Rust API (Axum)   â”‚               â”‚
â”‚  â”‚  - Vercel ë°°í¬      â”‚â”€â”€â”€â”€â”€â–¶â”‚  - /api/auth/*     â”‚               â”‚
â”‚  â”‚  - NextAuth ìœ ì§€    â”‚      â”‚  - /api/newsletter â”‚               â”‚
â”‚  â”‚  - DBì‘ì—… ìœ„ì„      â”‚      â”‚  - /api/checkout   â”‚               â”‚
â”‚  â”‚                     â”‚      â”‚  - /api/chat       â”‚               â”‚
â”‚  â”‚  pizzar.ing         â”‚      â”‚  api.pizzar.ing    â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                          â”‚                          â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚           â”‚                              â”‚                      â”‚   â”‚
â”‚           â–¼                              â–¼                      â–¼   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Supabase       â”‚      â”‚  Hugging Face       â”‚   â”‚ External  â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚      â”‚  Spaces             â”‚   â”‚ Services  â”‚  â”‚
â”‚  â”‚  - PostgreSQL   â”‚      â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚
â”‚  â”‚  - Auth         â”‚      â”‚  RAG Service        â”‚   â”‚ - Stripe  â”‚  â”‚
â”‚  â”‚  - Storage      â”‚      â”‚  (FastAPI + Gemini) â”‚   â”‚ - Resend  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ Migration Phases

| Phase | ì‘ì—… | ìƒíƒœ | ì˜ˆìƒ ì‹œê°„ |
|-------|------|------|----------|
| 0 | CURRENT-WORK.md ì—…ë°ì´íŠ¸ | âœ… ì™„ë£Œ | 10ë¶„ |
| 1 | ~~Static Export~~ (ì·¨ì†Œ - Vercel SSR ìœ ì§€) | âŒ ì·¨ì†Œ | - |
| 2 | Rust API ê¸°ë³¸ êµ¬ì¡° (Axum + Diesel) | âœ… ì™„ë£Œ | 2ì‹œê°„ |
| 3 | Diesel ìŠ¤í‚¤ë§ˆ (ê¸°ì¡´ Supabase DB) | âœ… ì™„ë£Œ | 2ì‹œê°„ |
| 4 | Auth ì—”ë“œí¬ì¸íŠ¸ (Supabase Auth) | âœ… ì™„ë£Œ | 2ì‹œê°„ |
| 5 | Newsletter/Checkout/Shop/Admin ì—”ë“œí¬ì¸íŠ¸ | âœ… ì™„ë£Œ | 1~2ì‹œê°„ |
| 6 | RAG í”„ë¡ì‹œ ì—”ë“œí¬ì¸íŠ¸ (chat/search) | âœ… ì™„ë£Œ | 30ë¶„ |
| 7 | OCI ë°°í¬ (Rust ë°”ì´ë„ˆë¦¬) | â³ ëŒ€ê¸° | 30ë¶„ |
| 8 | Vercel ë°°í¬ + ë„ë©”ì¸ ì—°ê²° | â³ ëŒ€ê¸° | 30ë¶„ |
| 9 | Hugging Face RAG ë°°í¬ | â³ ëŒ€ê¸° | 1ì‹œê°„ |

**ì´ ì˜ˆìƒ: ~10ì‹œê°„ (2ì¼)**

### âœ… ìµœê·¼ ì™„ë£Œ (í•µì‹¬)
- **Magic Link ì¸ì¦ êµ¬í˜„**:
  - Rust API: `POST /api/auth/magic-link` (í† í° ìƒì„± + SMTP ì´ë©”ì¼ ë°œì†¡)
  - Rust API: `POST /api/auth/verify` (í† í° ê²€ì¦ + ì„¸ì…˜ ìƒì„±)
  - Next.js: `/login` í˜ì´ì§€ (ì»¤ìŠ¤í…€ ë¡œê·¸ì¸ UI)
  - Next.js: `/api/auth/callback/email` (ì½œë°± ì²˜ë¦¬ + ì„¸ì…˜ ì¿ í‚¤ ì„¤ì •)
  - lettre í¬ë ˆì´íŠ¸ë¡œ SMTP ì´ë©”ì¼ ë°œì†¡ (Gmail í˜¸í™˜)
  - NextAuth PrismaAdapterì™€ í˜¸í™˜ë˜ëŠ” ì„¸ì…˜ í…Œì´ë¸” ì‚¬ìš©
- **Stripe Webhook ì™„ì „ êµ¬í˜„**: Rust `webhook.rs`ì— HMAC-SHA256 ì„œëª… ê²€ì¦ + checkout.session.completed ì²˜ë¦¬
- **Next.js API routes ì œê±°**: `/api/webhook/stripe`, `/api/knowledge-shelf/post` ì‚­ì œ
- **Prisma ì§ì ‘ ì ‘ê·¼ ì œê±°**: `knowledge-shelf-marginalia.server.ts` â†’ Rust API í˜¸ì¶œë¡œ êµì²´

### ğŸ“Š ë‚¨ì€ API Routes (ì •ë¦¬ë¨)
- `apps/blog/src/app/api/auth/[...nextauth]/route.ts` - **ìœ ì§€** (NextAuth PrismaAdapter í•„ìˆ˜)

### ğŸ”œ ë‚¨ì€ ì‘ì—… (ìš°ì„ ìˆœìœ„)
1) **SMTP í™˜ê²½ë³€ìˆ˜ ì„¤ì •**: Gmail App Password ë°œê¸‰ í›„ `.env`ì— `SMTP_*` ì¶”ê°€
2) **pg_cron ì„¤ì •**: Supabaseì—ì„œ ë§Œë£Œ í† í° ìë™ ì‚­ì œ ìŠ¤ì¼€ì¤„ ì¶”ê°€
3) **OCI ë°°í¬**: Rust ë°”ì´ë„ˆë¦¬ í¬ë¡œìŠ¤ ì»´íŒŒì¼ ë° ë°°í¬
4) **Vercel ë°°í¬**: í™˜ê²½ë³€ìˆ˜ ì„¤ì • + ë„ë©”ì¸ ì—°ê²°
5) **Stripe Webhook URL ë³€ê²½**: Dashboardì—ì„œ `api.pizzar.ing/api/webhook/stripe`ë¡œ ë³€ê²½

---

## ğŸ”§ Key Technical Decisions

### 1. ì™œ Rustì¸ê°€?
- ë©”ëª¨ë¦¬ ì‚¬ìš©: ~20MB (OCI 1GBì—ì„œ ì—¬ìœ )
- Cold start ì—†ìŒ (ë°”ì´ë„ˆë¦¬ ì‹¤í–‰)
- íƒ€ì… ì•ˆì „ì„± (ì»´íŒŒì¼ íƒ€ì„ ì—ëŸ¬)

### 2. Prisma â†’ Diesel
- ê¸°ì¡´ Supabase DB ìœ ì§€
- Dieselë¡œ ìŠ¤í‚¤ë§ˆë§Œ ì •ì˜ (ë§ˆì´ê·¸ë ˆì´ì…˜ X)
- cuid2 crateë¡œ ID ìƒì„±

### 3. NextAuth ìœ ì§€ + Magic Link ì¸ì¦
- NextAuth PrismaAdapterë¡œ ì„¸ì…˜ ê´€ë¦¬ (Vercelì—ì„œ ë™ì‘)
- ë§¤ì§ë§í¬ ë°œì†¡/ê²€ì¦ë§Œ Rust APIì—ì„œ ì²˜ë¦¬ (cold start íšŒí”¼)
- ì„¸ì…˜ì€ DB ê¸°ë°˜ (JWT ì•„ë‹˜) - NextAuthê°€ ì¿ í‚¤ ê²€ì¦

### 4. Server Actions â†’ Rust API
- ëª¨ë“  Server Actionsì„ Rust ì—”ë“œí¬ì¸íŠ¸ë¡œ ì´ë™
- Stripe, Resend í˜¸ì¶œë„ Rustì—ì„œ

---

## ğŸ“ New Project Structure

```
orangec-at/
â”œâ”€â”€ apps/
â”‚   â””â”€â”€ blog/                    # Next.js (Vercel SSR)
â”‚       â”œâ”€â”€ src/app/[locale]/login/  # ì»¤ìŠ¤í…€ ë¡œê·¸ì¸ UI
â”‚       â””â”€â”€ src/                 # í”„ë¡ íŠ¸ì—”ë“œ + NextAuth
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ rag-service/             # FastAPI (Hugging Face)
â”‚   â””â”€â”€ blog-api/                # ğŸ†• Rust API (OCI)
â”‚       â”œâ”€â”€ Cargo.toml
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ main.rs
â”‚       â”‚   â”œâ”€â”€ routes/
â”‚       â”‚   â”œâ”€â”€ models/
â”‚       â”‚   â””â”€â”€ services/
â”‚       â””â”€â”€ diesel.toml
â”‚
â””â”€â”€ ...
```

---

## ğŸŒ Infrastructure

| ì„œë¹„ìŠ¤ | í”Œë«í¼ | ë„ë©”ì¸ | ë¹„ìš© |
|--------|--------|--------|------|
| Frontend | Vercel | pizzar.ing | $0 |
| API | OCI E2.1.Micro | api.pizzar.ing | $0 |
| RAG | Hugging Face | - (internal) | $0 |
| DB | Supabase | - | $0 |
| Domain | Porkbun | pizzar.ing | ~$10/ë…„ |

---

## âš ï¸ Blockers / Notes

1. **OCI ARM í’ˆì ˆ** - E2.1.Micro (AMD) ì‚¬ìš© ì¤‘
2. **Rust ë¹Œë“œ** - ì„œë²„ì—ì„œ ë¶ˆê°€, ë¡œì»¬ í¬ë¡œìŠ¤ ì»´íŒŒì¼ í•„ìš”
3. **ê¸°ì¡´ Phase 4 ì‘ì—…** - ì¼ì‹œ ì¤‘ë‹¨ (ì¸í”„ë¼ ì™„ë£Œ í›„ ì¬ê°œ)

---

## ğŸ“š Related Memories (Serena)

- `blog_infrastructure_redesign` - ì´ ì‘ì—…ì˜ ìƒì„¸ ê¸°ìˆ  ê²°ì •
- `project_overview` - í”„ë¡œì íŠ¸ ì „ì²´ ê°œìš”
- `rag_system_architecture` - RAG ì‹œìŠ¤í…œ ì„¤ê³„

---

## ğŸ”„ Session Handoff Checklist

ë‹¤ìŒ ì„¸ì…˜ ì‹œì‘ ì‹œ:
1. [ ] ì´ íŒŒì¼ ì½ê¸°
2. [ ] ìœ„ Phase í‘œì—ì„œ í˜„ì¬ ì§„í–‰ ìƒíƒœ í™•ì¸
3. [ ] `services/blog-api/` ë””ë ‰í† ë¦¬ ì¡´ì¬ ì—¬ë¶€ í™•ì¸
4. [ ] OCI VM ìƒíƒœ í™•ì¸ (SSH ì ‘ì† ê°€ëŠ¥ ì—¬ë¶€)

---

## ğŸ—‚ï¸ Other Active Work (Paused)

| í”„ë¡œì íŠ¸ | ìƒíƒœ | ì¬ê°œ ì‹œì  |
|----------|------|----------|
| Phase 4 (Mock â†’ Real) | â¸ï¸ ì¼ì‹œì¤‘ë‹¨ | ì¸í”„ë¼ ì™„ë£Œ í›„ |
| MDX Editor Extension | â¸ï¸ 40% | ë¸”ë¡œê·¸ ë°°í¬ í›„ |
| Content Marketing Team | â¸ï¸ ìœ íŠœë¸Œ ì´ìŠˆ | í•´ê²° í›„ |
